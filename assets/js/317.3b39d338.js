"use strict";(self.webpackChunkmy_docs_test=self.webpackChunkmy_docs_test||[]).push([[317],{1317:(t,i,s)=>{s.r(i),s.d(i,{HLSProvider:()=>p});var e=s(4614),a=s(9087),h=s(4903),n=s(4288),r=s(8543),o=s(4544),d=s(2595),c=s(5585),l=s(8092);class u{constructor(t,i){this.m=t,this.b=i,this.d=null,this.qb=null,this.rb={},this.sb=new Set,this.na=-1}get instance(){return this.d}setup(t){const{streamType:i}=this.b.$state,s=(0,n.p)(i).includes("live"),e=(0,n.p)(i).includes("ll-");this.d=new t({lowLatencyMode:e,backBufferLength:e?4:s?8:void 0,renderTextTracksNatively:!1,...this.rb});const a=this.Oi.bind(this);for(const i of Object.values(t.Events))this.d.on(i,a);this.d.on(t.Events.ERROR,this.Q.bind(this));for(const t of this.sb)t(this.d);this.b.player.dispatch("hls-instance",{detail:this.d}),this.d.attachMedia(this.m),this.d.on(t.Events.FRAG_LOADING,this.Pi.bind(this)),this.d.on(t.Events.AUDIO_TRACK_SWITCHED,this.Qi.bind(this)),this.d.on(t.Events.LEVEL_SWITCHED,this.Ri.bind(this)),this.d.on(t.Events.LEVEL_LOADED,this.Si.bind(this)),this.d.on(t.Events.NON_NATIVE_TEXT_TRACKS_FOUND,this.Ti.bind(this)),this.d.on(t.Events.CUES_PARSED,this.Ui.bind(this)),this.b.qualities[r.Q.Ia]=this.je.bind(this),(0,n.l)(this.b.qualities,"change",this.ke.bind(this)),(0,n.l)(this.b.audioTracks,"change",this.le.bind(this)),this.qb=(0,n.g)(this.me.bind(this))}aa(t,i){return new n.D((t=>(0,n.S)(t))(t),{detail:i})}me(){if(!this.b.$state.live())return;const t=new c.R(this.ne.bind(this));return t.Xa(),t.$.bind(t)}ne(){this.b.$state.liveSyncPosition.set(this.d?.liveSyncPosition??1/0)}Oi(t,i){this.b.player?.dispatch(this.aa(t,i))}Ti(t,i){const s=this.aa(t,i);let e=-1;for(let t=0;t<i.tracks.length;t++){const a=i.tracks[t],h=a.subtitleTrack??a.closedCaptions,n=new o.T({id:`hls-${a.kind}-${t}`,src:h?.url,label:a.label,language:h?.lang,kind:a.kind,default:a.default});n[o.a.ma]=2,n[o.a.hb]=()=>{"showing"===n.mode?(this.d.subtitleTrack=t,e=t):e===t&&(this.d.subtitleTrack=-1,e=-1)},this.b.textTracks.add(n,s)}}Ui(t,i){const s=this.d?.subtitleTrack,e=this.b.textTracks.getById(`hls-${i.type}-${s}`);if(!e)return;const a=this.aa(t,i);for(const t of i.cues)t.positionAlign="auto",e.addCue(t,a)}Qi(t,i){const s=this.b.audioTracks[i.id];if(s){const e=this.aa(t,i);this.b.audioTracks[d.L.ea](s,!0,e)}}Ri(t,i){const s=this.b.qualities[i.level];if(s){const e=this.aa(t,i);this.b.qualities[d.L.ea](s,!0,e)}}Si(t,i){if(this.b.$state.canPlay())return;const{type:s,live:e,totalduration:a,targetduration:h}=i.details,o=this.aa(t,i);this.b.delegate.c("stream-type-change",e?"EVENT"===s&&Number.isFinite(a)&&h>=10?"live:dvr":"live":"on-demand",o),this.b.delegate.c("duration-change",a,o);const c=this.d.media;-1===this.d.currentLevel&&this.b.qualities[r.Q.Wa](!0,o);for(const t of this.d.audioTracks){const i={id:t.id.toString(),label:t.name,language:t.lang||"",kind:"main"};this.b.audioTracks[d.L.da](i,o)}for(const t of this.d.levels){const i={id:t.id?.toString()??t.height+"p",width:t.width,height:t.height,codec:t.codecSet,bitrate:t.bitrate};this.b.qualities[d.L.da](i,o)}c.dispatchEvent(new n.D("canplay",{trigger:o}))}Q(t,i){if(i.fatal)switch(i.type){case"networkError":this.pe(i.error);break;case"mediaError":this.d?.recoverMediaError();break;default:this.qc(i.error)}}Pi(){this.na>=0&&this._a()}pe(t){this._a(),this.d?.startLoad(),this.na=window.setTimeout((()=>{this.na=-1,this.qc(t)}),5e3)}_a(){clearTimeout(this.na),this.na=-1}qc(t){this.b.delegate.c("error",{message:t.message,code:1,error:t})}je(){this.d&&(this.d.currentLevel=-1)}ke(){const{qualities:t}=this.b;this.d&&!t.auto&&(this.d[t.switch+"Level"]=t.selectedIndex,a.I&&(this.m.currentTime=this.m.currentTime))}le(){const{audioTracks:t}=this.b;this.d&&this.d.audioTrack!==t.selectedIndex&&(this.d.audioTrack=t.selectedIndex)}Vi(t){this._a(),(0,n.i)(t.src)&&this.d?.loadSource(t.src)}Wi(){this._a(),this.d?.destroy(),this.d=null,this.qb?.(),this.qb=null}}class b{constructor(t,i,s){this.L=t,this.b=i,this.La=s,this.qe()}async qe(){const t={onLoadStart:this.Ma.bind(this),onLoaded:this.tb.bind(this),onLoadError:this.re.bind(this)};let i=await async function(t,i={}){if((0,n.i)(t)){i.onLoadStart?.();try{if(await(0,e.l)(t),!(0,n.x)(window.Hls))throw Error("");const s=window.Hls;return i.onLoaded?.(s),s}catch(t){i.onLoadError?.(t)}}}(this.L,t);if((0,n.h)(i)&&!(0,n.i)(this.L)&&(i=await async function(t,i={}){if(!(0,n.h)(t)){if(i.onLoadStart?.(),t.prototype&&t.prototype!==Function)return i.onLoaded?.(t),t;try{const s=(await t())?.default;if(!s||!s.isSupported)throw Error("");return i.onLoaded?.(s),s}catch(t){i.onLoadError?.(t)}}}(this.L,t)),!i)return null;if(!i.isSupported()){const t="[vidstack] `hls.js` is not supported in this environment";return this.b.player.dispatch(new n.D("hls-unsupported")),this.b.delegate.c("error",{message:t,code:4}),null}return i}Ma(){this.b.player.dispatch(new n.D("hls-lib-load-start"))}tb(t){this.b.player.dispatch(new n.D("hls-lib-loaded",{detail:t})),this.La(t)}re(t){const i=(0,l.c)(t);this.b.player.dispatch(new n.D("hls-lib-load-error",{detail:i})),this.b.delegate.c("error",{message:i.message,code:4,error:i})}}class p extends h.VideoProvider{constructor(){super(...arguments),this.$$PROVIDER_TYPE="HLS",this.rc=null,this.e=new u(this.video,this.b),this.oa="https://cdn.jsdelivr.net/npm/hls.js@^1.5.0/dist/hls.min.js"}get ctor(){return this.rc}get instance(){return this.e.instance}static{this.supported=(0,a.s)()}get type(){return"hls"}get canLiveSync(){return!0}get config(){return this.e.rb}set config(t){this.e.rb=t}get library(){return this.oa}set library(t){this.oa=t}preconnect(){(0,n.i)(this.oa)&&(0,e.p)(this.oa)}setup(){super.setup(),new b(this.oa,this.b,(t=>{this.rc=t,this.e.setup(t),this.b.delegate.c("provider-setup",this);const i=(0,n.p)(this.b.$state.source);i&&this.loadSource(i)}))}async loadSource(t,i){(0,n.i)(t.src)?(this.a.preload=i||"",this.ge(t,"application/x-mpegurl"),this.e.Vi(t),this.K=t):this.oc()}onInstance(t){const i=this.e.instance;return i&&t(i),this.e.sb.add(t),()=>this.e.sb.delete(t)}destroy(){this.e.Wi()}}}}]);